<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI CHUY√äN GIA T∆Ø T∆Ø·ªûNG QK7</title>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=76Y2N6U7"></script>
    <style>
        :root { --army: #1a2f1a; --gold: #ffeb3b; --red: #f44336; }
        body { background: var(--army); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: #0e1a0e; padding: 15px; text-align: center; border-bottom: 3px solid var(--gold); }
        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 12px; border-radius: 8px; max-width: 85%; line-height: 1.4; }
        .user { background: #2d4f2d; align-self: flex-end; border-right: 4px solid #4caf50; }
        .ai { background: #263238; align-self: flex-start; border-left: 4px solid var(--red); }
        #input-group { padding: 15px; background: #0e1a0e; display: flex; gap: 10px; align-items: center; }
        input { flex: 1; padding: 12px; border-radius: 5px; border: none; font-size: 1rem; }
        .btn { border: none; border-radius: 5px; cursor: pointer; font-weight: bold; height: 45px; }
        #mic-btn { background: var(--red); width: 50px; font-size: 20px; color: white; }
        #send-btn { background: #388e3c; color: white; padding: 0 20px; }
        .recording { animation: pulse 1s infinite; background: #ff5252 !important; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<header><h1 style="margin:0; font-size: 1.2rem; color: var(--gold);">CHUY√äN GIA T∆Ø T∆Ø·ªûNG QU√ÇN KHU 7</h1></header>

<div id="chat-window">
    <div class="msg ai">B√°o c√°o ƒë·ªìng ch√≠! T√¥i ƒë√£ s·∫µn s√†ng tr·ª±c chi·∫øn. H√£y nh·∫•n Micro ƒë·ªÉ n√≥i ho·∫∑c nh·∫≠p vƒÉn b·∫£n ƒë·ªÉ b√°o c√°o.</div>
</div>

<div id="input-group">
    <button id="mic-btn" class="btn" onclick="startRecognition()">üé§</button>
    <input type="text" id="user-input" placeholder="N√≥i ho·∫∑c nh·∫≠p b√°o c√°o...">
    <button id="send-btn" class="btn" onclick="sendMessage()">G·ª¨I</button>
</div>

<script>
    // L∆ØU √ù: Thay link n√†y b·∫±ng link ch√≠nh x√°c t·ª´ Render c·ªßa ƒë·ªìng ch√≠
    const API_URL = 'https://chatbot-tu-tuong.onrender.com/api/chat';

    // 1. CH·ª®C NƒÇNG NH·∫¨N DI·ªÜN GI·ªåNG N√ìI (NGHE)
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.lang = 'vi-VN';
        
        recognition.onstart = () => document.getElementById('mic-btn').classList.add('recording');
        recognition.onend = () => document.getElementById('mic-btn').classList.remove('recording');
        
        recognition.onresult = (event) => {
            const result = event.results[0][0].transcript;
            document.getElementById('user-input').value = result;
            sendMessage();
        };

        function startRecognition() { try { recognition.start(); } catch(e) { recognition.stop(); } }
    }

    // 2. CH·ª®C NƒÇNG G·ª¨I V√Ä PH·∫¢N H·ªíI (N√ìI)
    async function sendMessage() {
        const input = document.getElementById('user-input');
        const window = document.getElementById('chat-window');
        const text = input.value.trim();
        if (!text) return;

        window.innerHTML += `<div class="msg user"><b>ƒê·ªìng ch√≠:</b> ${text}</div>`;
        input.value = '';
        window.scrollTop = window.scrollHeight;

        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_input: text })
            });
            const data = await response.json();
            const reply = data.response;

            window.innerHTML += `<div class="msg ai"><b>Chuy√™n gia:</b> ${reply}</div>`;
            window.scrollTop = window.scrollHeight;

            // PH√ÅT GI·ªåNG N√ìI TI·∫æNG VI·ªÜT CHU·∫®N
            responsiveVoice.speak(reply, "Vietnamese Male", {rate: 1, pitch: 1});

        } catch (e) {
            window.innerHTML += `<div class="msg ai" style="color:var(--red)">B√°o c√°o: M·∫•t k·∫øt n·ªëi s·ªü ch·ªâ huy! H√£y ki·ªÉm tra link Render.</div>`;
        }
    }

    document.getElementById('user-input').addEventListener('keypress', (e) => { if(e.key === 'Enter
