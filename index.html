<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI CHUY√äN GIA QK7 TO√ÄN DI·ªÜN</title>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=76Y2N6U7"></script>
    <style>
        :root { --army: #1a2f1a; --gold: #ffeb3b; --red: #f44336; }
        body { background: var(--army); color: white; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: #0e1a0e; padding: 15px; text-align: center; border-bottom: 3px solid var(--gold); }
        .controls { background: #243b24; padding: 10px; display: flex; justify-content: center; gap: 10px; font-size: 0.8rem; border-bottom: 1px solid #3e5a3e; flex-wrap: wrap; }
        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 12px; border-radius: 8px; max-width: 80%; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .user { background: #2d4f2d; align-self: flex-end; border-right: 5px solid #4caf50; }
        .ai { background: #263238; align-self: flex-start; border-left: 5px solid var(--red); }
        #input-group { padding: 15px; background: #0e1a0e; display: flex; gap: 10px; align-items: center; }
        input { flex: 1; padding: 12px; border-radius: 5px; border: none; }
        .btn { border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; height: 45px; }
        #mic-btn { background: var(--red); width: 50px; color: white; font-size: 20px; }
        #mic-btn.recording { animation: pulse 1s infinite; background: #ff5252; }
        #send-btn { background: #388e3c; color: white; padding: 0 20px; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        audio { height: 30px; filter: invert(1); }
    </style>
</head>
<body>

<header><h1 style="margin:0; font-size: 1.1rem; color: var(--gold);">CHUY√äN GIA T∆Ø T∆Ø·ªûNG QU√ÇN KHU 7</h1></header>

<div class="controls">
    <label>Gi·ªçng:</label>
    <select id="v-select"><option value="Vietnamese Male">Nam b·ªô</option><option value="Vietnamese Female">N·ªØ b·ªô</option></select>
    <label>T·ªëc ƒë·ªô:</label>
    <input type="range" id="v-rate" min="0.5" max="1.5" step="0.1" value="1" style="width:70px">
    <label>Nh·∫°c th∆∞ gi√£n:</label>
    <audio controls loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg"></audio>
</div>

<div id="chat-window">
    <div class="msg ai">B√°o c√°o ƒë·ªìng ch√≠! H·ªá th·ªëng tr·ª±c chi·∫øn ƒë√£ s·∫µn s√†ng. ƒê·ªìng ch√≠ c√≥ th·ªÉ nh·∫•n üé§ ƒë·ªÉ ra l·ªánh ho·∫∑c nh·∫≠p vƒÉn b·∫£n.</div>
</div>

<div id="input-group">
    <button id="mic-btn" class="btn" onclick="startMic()">üé§</button>
    <input type="text" id="user-input" placeholder="Nh·∫≠p n·ªôi dung b√°o c√°o...">
    <button id="send-btn" class="btn" onclick="send()">G·ª¨I L·ªÜNH</button>
</div>

<script>
    // THAY LINK RENDER C·ª¶A ƒê·ªíNG CH√ç V√ÄO ƒê√ÇY
    const API_URL = 'https://chatbot-tu-tuong.onrender.com/api/chat';

    // 1. NH·∫¨N DI·ªÜN GI·ªåNG N√ìI
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const rec = new SpeechRecognition();
        rec.lang = 'vi-VN';
        rec.onstart = () => document.getElementById('mic-btn').classList.add('recording');
        rec.onend = () => document.getElementById('mic-btn').classList.remove('recording');
        rec.onresult = (e) => { document.getElementById('user-input').value = e.results[0][0].transcript; send(); };
        function startMic() { try { rec.start(); } catch(err) { rec.stop(); } }
    }

    // 2. G·ª¨I V√Ä PH√ÅT GI·ªåNG N√ìI
    async function send() {
        const input = document.getElementById('user-input');
        const windowChat = document.getElementById('chat-window');
        const text = input.value.trim();
        if(!text) return;

        windowChat.innerHTML += `<div class="msg user"><b>ƒê·ªìng ch√≠:</b> ${text}</div>`;
        input.value = '';
        windowChat.scrollTop = windowChat.scrollHeight;

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_input: text })
            });
            const data = await res.json();
            windowChat.innerHTML += `<div class="msg ai"><b>Chuy√™n gia:</b> ${data.response}</div>`;
            windowChat.scrollTop = windowChat.scrollHeight;
            
            // PH√ÅT GI·ªåNG N√ìI
            responsiveVoice.speak(data.response, document.getElementById('v-select').value, {rate: document.getElementById('v-rate').value});
        } catch(e) {
            windowChat.innerHTML += `<div class="msg ai" style="color:red">B√°o c√°o: M·∫•t k·∫øt n·ªëi s·ªü ch·ªâ huy!</div>`;
        }
    }
</script>
</body>
</html>
